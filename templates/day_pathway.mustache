<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{day_title}} - {{course_name}}</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{wwwroot}}/theme/remui_kids/style/day_pathway.css" rel="stylesheet">
</head>
<body>
    <div class="day-pathway-container">
        <!-- Header -->
        <div class="pathway-header">
            <div class="header-content">
                <div class="back-button">
                    <a href="{{back_url}}" class="btn-back">
                        <i class="fas fa-arrow-left"></i>
                        Back to Day Selection
                    </a>
                </div>
                <div class="pathway-title">
                    <h1>{{day_title}}</h1>
                    <p class="pathway-subtitle">{{day_subtitle}}</p>
                </div>
            </div>
        </div>

        <!-- Progress Overview -->
        <div class="progress-overview">
            <div class="progress-info">
                <div class="progress-text">
                    <span class="progress-percentage">{{day_progress}}%</span>
                    <span class="progress-label">Complete</span>
                </div>
                <div class="progress-details">
                    <span class="completed-count">{{completed_activities}}</span>
                    <span class="total-count">of {{total_activities}} activities completed</span>
                </div>
            </div>
        </div>

        <!-- Road Timeline -->
        <div class="road-timeline-section">
            <div class="timeline-container">
                <!-- Start Button -->
                <div class="timeline-start">
                    <button class="timeline-button start-button">
                        <i class="fas fa-play"></i>
                        <span>Start</span>
                    </button>
                </div>

                <!-- Road Timeline -->
                <div class="road-timeline">
                    <div class="road-container">
                        <!-- Dynamic Winding Road -->
                        <div class="winding-road">
                            <svg class="road-svg" viewBox="0 0 800 400" preserveAspectRatio="xMidYMid meet">
                                <defs>
                                    <!-- Road gradient -->
                                    <linearGradient id="roadGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style="stop-color:#6b7280;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#4b5563;stop-opacity:1" />
                                    </linearGradient>
                                    
                                    <!-- Dashed line pattern -->
                                    <pattern id="dashedLine" patternUnits="userSpaceOnUse" width="20" height="4">
                                        <rect width="12" height="4" fill="#ffffff" rx="2"/>
                                        <rect x="12" width="8" height="4" fill="transparent"/>
                                    </pattern>
                                </defs>
                                
                                <!-- Dynamic road path - will be generated by JavaScript -->
                                <path id="dynamicRoadPath" 
                                      stroke="url(#roadGradient)" 
                                      stroke-width="40" 
                                      fill="none" 
                                      stroke-linecap="round"/>
                                
                                <!-- Dashed center line -->
                                <path id="dynamicDashedPath" 
                                      stroke="url(#dashedLine)" 
                                      stroke-width="6" 
                                      fill="none" 
                                      stroke-linecap="round"/>
                            </svg>
                        </div>
                        
                        <!-- Road Markers -->
                        {{#pathway_items}}
                        <div class="road-marker" data-order="{{order}}" data-completed="{{completed}}" style="left: {{road_position_x}}%; top: {{road_position_y}}%;">
                            <div class="pin-container">
                                <div class="teardrop-pin {{#completed}}completed{{/completed}} marker-{{order}}">
                                    <div class="pin-circle">
                                        {{^completed}}
                                            <div class="pin-number">{{order}}</div>
                                        {{/completed}}
                                        {{#completed}}
                                            <div class="completion-check">
                                                <i class="fas fa-check"></i>
                                            </div>
                                        {{/completed}}
                                    </div>
                                    <div class="pin-point"></div>
                                </div>
                            </div>
                            
                            <!-- Activity Info Box -->
                            <div class="activity-info-box">
                                <div class="info-title">{{name}}</div>
                                <div class="info-description">{{description}}</div>
                            </div>
                        </div>
                        {{/pathway_items}}
                        
                        <!-- Road Title -->
                        <div class="road-title">
                            <h3>Learning Roadmap - Day {{day_number}}</h3>
                            <p>Professional Development Pathway</p>
                        </div>
                    </div>
                </div>

                <!-- Complete Button -->
                <div class="timeline-end">
                    <button class="timeline-button complete-button {{#day_progress}}completed{{/day_progress}}">
                        <i class="fas fa-flag-checkered"></i>
                        <span>Complete</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Learning Pathway Items -->
        <div class="pathway-items-section">
            <div class="items-grid">
                {{#pathway_items}}
                <div class="pathway-item" data-order="{{order}}" data-completed="{{completed}}" onclick="expandItem({{order}})">
                    <div class="item-card">
                        <div class="item-header">
                            <div class="item-icon">
                                <i class="{{icon}}"></i>
                            </div>
                            <div class="item-status {{#completed}}completed{{/completed}}">
                                {{#completed}}
                                    <i class="fas fa-check-circle"></i>
                                {{/completed}}
                                {{^completed}}
                                    <i class="fas fa-clock"></i>
                                {{/completed}}
                            </div>
                        </div>
                        
                        <div class="item-content">
                            <h3 class="item-title">{{name}}</h3>
                            <p class="item-type">{{type}}</p>
                        </div>
                    </div>

                    <!-- Expanded Content -->
                    <div class="item-expanded" id="expanded-{{order}}">
                        <div class="expanded-content">
                            <div class="expanded-header">
                                <div class="expanded-icon">
                                    <i class="{{icon}}"></i>
                                </div>
                                <div class="expanded-title">
                                    <h4>{{name}}</h4>
                                    <p>{{type}}</p>
                                </div>
                            </div>
                            
                            <div class="expanded-body">
                                <p class="expanded-description">{{description}}</p>
                                
                                <div class="expanded-actions">
                                    {{#completed}}
                                        <button class="action-btn completed-btn">
                                            <i class="fas fa-check"></i>
                                            Completed
                                        </button>
                                    {{/completed}}
                                    {{^completed}}
                                        <a href="{{wwwroot}}/mod/{{modname}}/view.php?id={{id}}" class="action-btn primary-btn">
                                            <i class="fas fa-external-link-alt"></i>
                                            Click to view content
                                        </a>
                                    {{/completed}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {{/pathway_items}}
            </div>
        </div>

        <!-- Pathway Summary -->
        <div class="pathway-summary">
            <div class="summary-content">
                <div class="summary-stats">
                    <div class="stat-item">
                        <div class="stat-number">{{total_activities}}</div>
                        <div class="stat-label">Total Activities</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{completed_activities}}</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{day_progress}}%</div>
                        <div class="stat-label">Progress</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Item expansion functionality
        function expandItem(order) {
            const item = document.querySelector(`[data-order="${order}"]`);
            const expanded = document.getElementById(`expanded-${order}`);
            
            // Close all other expanded items
            document.querySelectorAll('.item-expanded').forEach(exp => {
                if (exp.id !== `expanded-${order}`) {
                    exp.classList.remove('active');
                }
            });
            
            // Toggle current item
            expanded.classList.toggle('active');
            
            // Scroll to expanded item if it's not visible
            if (expanded.classList.contains('active')) {
                setTimeout(() => {
                    expanded.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'nearest' 
                    });
                }, 300);
            }
        }

        // Timeline marker interactions
        document.querySelectorAll('.timeline-marker').forEach(marker => {
            marker.addEventListener('click', function() {
                const order = this.getAttribute('data-order');
                expandItem(order);
            });
        });

        // Add animations on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Animate timeline markers
            const markers = document.querySelectorAll('.timeline-marker');
            markers.forEach((marker, index) => {
                marker.style.opacity = '0';
                marker.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    marker.style.transition = 'all 0.5s ease';
                    marker.style.opacity = '1';
                    marker.style.transform = 'translateY(0)';
                }, index * 200);
            });
            
            // Animate pathway items
            const items = document.querySelectorAll('.pathway-item');
            items.forEach((item, index) => {
                item.style.opacity = '0';
                item.style.transform = 'translateY(30px)';
                
                setTimeout(() => {
                    item.style.transition = 'all 0.6s ease';
                    item.style.opacity = '1';
                    item.style.transform = 'translateY(0)';
                }, 300 + (index * 150));
            });
            
            // Animate road timeline
            const roadLine = document.querySelector('.road-line');
            const roadDashes = document.querySelector('.road-dashes');
            
            if (roadLine) {
                roadLine.style.width = '0%';
                setTimeout(() => {
                    roadLine.style.transition = 'width 2s ease-in-out';
                    roadLine.style.width = '100%';
                }, 500);
            }
            
            if (roadDashes) {
                roadDashes.style.width = '0%';
                setTimeout(() => {
                    roadDashes.style.transition = 'width 2.5s ease-in-out';
                    roadDashes.style.width = '100%';
                }, 700);
            }
        });

        // Close expanded items when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.pathway-item')) {
                document.querySelectorAll('.item-expanded.active').forEach(expanded => {
                    expanded.classList.remove('active');
                });
            }
        });

        // Function to go to specific day pathway
        function goToDayPathway(dayNumber) {
            const courseId = new URLSearchParams(window.location.search).get('courseid');
            window.location.href = `{{wwwroot}}/theme/remui_kids/day_pathway.php?courseid=${courseId}&day=${dayNumber}`;
        }

        // Generate dynamic road path based on marker positions
        function generateDynamicRoadPath() {
            const roadMarkers = document.querySelectorAll('.road-marker');
            if (roadMarkers.length === 0) return;

            const roadPath = document.getElementById('dynamicRoadPath');
            const dashedPath = document.getElementById('dynamicDashedPath');
            
            if (!roadPath || !dashedPath) return;

            let pathData = '';
            const points = [];

            // Collect all marker positions
            roadMarkers.forEach((marker, index) => {
                const style = marker.style;
                const x = parseFloat(style.left);
                const y = parseFloat(style.top);
                
                // Convert percentage to SVG coordinates
                const svgX = (x / 100) * 800;
                const svgY = (y / 100) * 400;
                
                points.push({ x: svgX, y: svgY });
            });

            if (points.length === 0) return;

            // Generate smooth path through all points
            if (points.length === 1) {
                pathData = `M ${points[0].x} ${points[0].y}`;
            } else if (points.length === 2) {
                pathData = `M ${points[0].x} ${points[0].y} L ${points[1].x} ${points[1].y}`;
            } else {
                // Create smooth curve through all points
                pathData = `M ${points[0].x} ${points[0].y}`;
                
                for (let i = 1; i < points.length; i++) {
                    const prevPoint = points[i - 1];
                    const currentPoint = points[i];
                    
                    // Calculate control points for smooth curves
                    const controlX = (prevPoint.x + currentPoint.x) / 2;
                    const controlY = (prevPoint.y + currentPoint.y) / 2;
                    
                    pathData += ` Q ${controlX} ${controlY} ${currentPoint.x} ${currentPoint.y}`;
                }
            }

            // Apply the path to both road and dashed line
            roadPath.setAttribute('d', pathData);
            dashedPath.setAttribute('d', pathData);
        }

        // Generate road path when page loads
        document.addEventListener('DOMContentLoaded', function() {
            generateDynamicRoadPath();
        });

        // Regenerate path when window resizes
        window.addEventListener('resize', function() {
            generateDynamicRoadPath();
        });
    </script>
</body>
</html>
