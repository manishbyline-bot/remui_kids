{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template theme_remui_kids/analytics_dashboard

    Analytics Dashboard template

    Context variables required for this template:
    * wwwroot - Moodle wwwroot
    * sitename - Site name
    * analytics - Analytics data object
    * user - Current user object

    Example context (json):
    {
        "wwwroot": "http://localhost/moodle",
        "sitename": "My Site",
        "analytics": {
            "total_training_cost": "78.8k",
            "new_users": 2150,
            "total_active_users": 1784,
            "learning_effectiveness": "12.3%",
            "revenue_trends": {...},
            "training_categories": [...],
            "regional_participation": {...},
            "faculty_enrollment": [...],
            "training_feedback": [...]
        },
        "user": {...}
    }
}}

<div class="analytics-dashboard">
    <!-- Breadcrumb Navigation -->
    <div class="analytics-breadcrumb">
        <a href="{{wwwroot}}">{{sitename}}</a> &gt; <span>Dashboard</span>
    </div>

    <!-- Dashboard Title -->
    <h1 class="analytics-title">Dashboard</h1>

    <!-- KPI Cards Section -->
    <div class="kpi-section">
        <!-- Total Training Cost -->
        <div class="kpi-card">
            <div class="kpi-header">
                <span class="kpi-icon">üïê</span>
            </div>
            <div class="kpi-value">${{analytics.total_training_cost}}</div>
            <div class="kpi-label">Total Training C...</div>
            <div class="kpi-chart"></div>
        </div>

        <!-- New Users -->
        <div class="kpi-card">
            <div class="kpi-header">
                <span class="kpi-icon">üìà</span>
            </div>
            <div class="kpi-value">{{analytics.new_users}}</div>
            <div class="kpi-label">New Users</div>
            <div class="kpi-chart"></div>
        </div>

        <!-- Total Active Users -->
        <div class="kpi-card">
            <div class="kpi-header">
                <span class="kpi-icon">üë•</span>
            </div>
            <div class="kpi-value">{{analytics.total_active_users}}</div>
            <div class="kpi-label">Total Active Us...</div>
            <div class="kpi-chart"></div>
        </div>

        <!-- Learning Effectiveness -->
        <div class="kpi-card">
            <div class="kpi-header">
                <span class="kpi-icon">üë§</span>
            </div>
            <div class="kpi-value">{{analytics.learning_effectiveness}}</div>
            <div class="kpi-label">Learning Effect...</div>
            <div class="kpi-chart"></div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
        <!-- Revenue Trends Chart -->
        <div class="chart-card">
            <div class="chart-header">
                <h2 class="chart-title">Revenue Trends</h2>
                <div class="chart-filters">
                    <button class="chart-filter active">ALL</button>
                    <button class="chart-filter">1M</button>
                    <button class="chart-filter">6M</button>
                    <button class="chart-filter">1Y</button>
                </div>
            </div>
            
            <div class="revenue-chart">
                <div class="revenue-bar"></div>
                <div class="revenue-bar"></div>
                <div class="revenue-bar"></div>
            </div>
            
            <div class="chart-legend">
                <div class="legend-item">
                    <div class="legend-color legend-purple"></div>
                    <span>Training Hours Logged</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-green"></div>
                    <span>Active Faculty Engagement</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-light-purple"></div>
                    <span>Training Sessions Completed</span>
                </div>
            </div>
        </div>

        <!-- Training by Category -->
        <div class="chart-card">
            <div class="chart-header">
                <h2 class="chart-title">Training by Category</h2>
                <div class="chart-filters">
                    <button class="chart-filter active">ALL</button>
                    <button class="chart-filter">1M</button>
                    <button class="chart-filter">6M</button>
                    <button class="chart-filter">1Y</button>
                </div>
            </div>
            
            <div class="training-categories">
                {{#analytics.training_categories}}
                <div class="category-item {{color}}">
                    <div class="category-info">
                        <h4>{{name}}</h4>
                        <div class="category-stats">{{sessions_completed}} Sessions Completed, {{percentage}}% Percentage</div>
                    </div>
                    <div class="category-growth {{#growth_positive}}positive{{/growth_positive}}{{^growth_positive}}negative{{/growth_positive}}">
                        {{growth}}
                    </div>
                </div>
                {{/analytics.training_categories}}
            </div>
        </div>
    </div>

    <!-- Faculty Training Participation by Region -->
    <div class="chart-card" style="margin-bottom: 32px;">
        <div class="chart-header">
            <h2 class="chart-title">Faculty Training Participation by Region</h2>
            <button class="view-all-btn">View Data</button>
        </div>
        <div class="regional-map">
            <div class="regional-marker"></div>
        </div>
    </div>

    <!-- Tables Section -->
    <div class="tables-section">
        <!-- Faculty Enrollment Table -->
        <div class="table-card">
            <div class="table-header">
                <h2 class="table-title">Faculty Enrollment</h2>
                <a href="#" class="view-all-btn">View All</a>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Enrollment Date</th>
                        <th>Faculty Name</th>
                        <th>Training Status</th>
                    </tr>
                </thead>
                <tbody>
                    {{#analytics.faculty_enrollment}}
                    <tr>
                        <td>{{id}}</td>
                        <td>{{enrollment_date}}</td>
                        <td>
                            <div class="faculty-info">
                                <div class="faculty-avatar">{{initials}}</div>
                                <span>{{name}}</span>
                            </div>
                        </td>
                        <td><span class="status-badge {{status_class}}">{{status}}</span></td>
                    </tr>
                    {{/analytics.faculty_enrollment}}
                </tbody>
            </table>
        </div>

        <!-- Training Feedback & Performance Scores -->
        <div class="table-card">
            <div class="table-header">
                <h2 class="table-title">Training Feedback & Performance Scores</h2>
                <a href="#" class="view-all-btn">View All</a>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Training Date</th>
                        <th>Faculty Name</th>
                        <th>Score</th>
                        <th>Feedback Summary</th>
                    </tr>
                </thead>
                <tbody>
                    {{#analytics.training_feedback}}
                    <tr>
                        <td>{{id}}</td>
                        <td>{{training_date}}</td>
                        <td>
                            <div class="faculty-info">
                                <div class="faculty-avatar">{{initials}}</div>
                                <span>{{name}}</span>
                            </div>
                        </td>
                        <td><span class="score-badge {{score_class}}">{{score}}</span></td>
                        <td>{{feedback_summary}}</td>
                    </tr>
                    {{/analytics.training_feedback}}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Chart filter functionality
    const chartFilters = document.querySelectorAll('.chart-filter');
    chartFilters.forEach(filter => {
        filter.addEventListener('click', function() {
            // Remove active class from all filters in the same group
            const parent = this.closest('.chart-filters');
            parent.querySelectorAll('.chart-filter').forEach(f => f.classList.remove('active'));
            // Add active class to clicked filter
            this.classList.add('active');
        });
    });

    // Add smooth scrolling for better UX
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Add loading animation for data refresh
    function showLoadingState() {
        const cards = document.querySelectorAll('.kpi-card, .chart-card, .table-card');
        cards.forEach(card => {
            card.classList.add('loading-placeholder');
        });
        
        setTimeout(() => {
            cards.forEach(card => {
                card.classList.remove('loading-placeholder');
            });
        }, 1500);
    }

    // Simulate data refresh every 30 seconds (optional)
    // setInterval(showLoadingState, 30000);
});
</script>
