{{!
    Section Viewer Template
    
    @template theme_remui_kids/section_viewer
    
    Section viewer with activities in linked list format
}}

<!-- Include section viewer CSS -->
<link rel="stylesheet" href="{{wwwroot}}/theme/remui_kids/style/section_viewer.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<div class="section-viewer-container">
    <!-- Page Header -->
    <div class="section-viewer-header">
        <div class="header-content">
            <div class="course-info">
                <div class="course-image">
                    <img src="{{course_image_url}}" alt="{{course.fullname}}" onerror="this.src='{{wwwroot}}/theme/remui_kids/pix/default_course.svg'">
                </div>
                <div class="course-details">
                    <h1>{{course.fullname}}</h1>
                    <h2 class="section-title">{{section_name}}</h2>
                    <div class="course-meta">
                        <span class="meta-item">
                            <i class="fas fa-tasks"></i>
                            {{total_activities}} Activities
                        </span>
                        <span class="meta-item">
                            <i class="fas fa-check-circle"></i>
                            {{completed_count}} Completed
                        </span>
                        <span class="meta-item">
                            <i class="fas fa-chart-line"></i>
                            {{progress_percentage}}% Progress
                        </span>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <a href="{{back_url}}" class="btn-back">
                    <i class="fas fa-arrow-left"></i>
                    Back to Learning Path
                </a>
            </div>
        </div>
    </div>

    <!-- Section Content -->
    <div class="section-viewer-content">
        <!-- Section Summary -->
        {{#section_summary}}
        <div class="section-summary">
            <div class="summary-content">{{{section_summary}}}</div>
        </div>
        {{/section_summary}}

        <!-- Progress Bar -->
        <div class="progress-section">
            <div class="progress-header">
                <h3>Section Progress</h3>
                <span class="progress-text">{{completed_count}}/{{total_activities}} activities completed</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{progress_percentage}}%"></div>
            </div>
        </div>

        <!-- Activities List -->
        <div class="activities-container">
            <h3 class="activities-title">
                <i class="fas fa-list"></i>
                Section Activities
            </h3>
        
        <div class="activities-list">
            {{#activities}}
            <div class="activity-item {{#completed}}completed{{/completed}}" data-activity="{{id}}">
                <div class="activity-content">
                    <div class="activity-icon">
                        {{#completed}}
                        <i class="fas fa-check-circle text-success"></i>
                        {{/completed}}
                        {{^completed}}
                        <i class="fas fa-{{icon}} text-primary"></i>
                        {{/completed}}
                    </div>
                    
                    <div class="activity-details">
                        <h5 class="activity-name">{{name}}</h5>
                        <div class="activity-meta">
                            <span class="activity-type">{{modname}}</span>
                            {{#completed}}
                            <span class="status-badge completed">
                                <i class="fas fa-check"></i>
                                Completed
                            </span>
                            {{/completed}}
                            {{^completed}}
                            <span class="status-badge pending">
                                <i class="fas fa-clock"></i>
                                Pending
                            </span>
                            {{/completed}}
                        </div>
                    </div>
                    
                    <div class="activity-actions">
                        <a href="{{url}}" class="btn btn-sm {{#completed}}btn-outline-success{{/completed}}{{^completed}}btn-primary{{/completed}}">
                            {{#completed}}
                            <i class="fas fa-eye"></i>
                            Review
                            {{/completed}}
                            {{^completed}}
                            <i class="fas fa-play"></i>
                            Start
                            {{/completed}}
                        </a>
                    </div>
                </div>
            </div>
            {{/activities}}
        </div>
        </div>

        <!-- Navigation -->
        <div class="section-navigation">
            {{#prev_section}}
            <a href="{{wwwroot}}/theme/remui_kids/section_viewer.php?courseid={{courseid}}&section={{section}}" class="nav-button prev">
                <i class="fas fa-chevron-left"></i>
                <span>Previous Section</span>
            </a>
            {{/prev_section}}
            
            {{#next_section}}
            <a href="{{wwwroot}}/theme/remui_kids/section_viewer.php?courseid={{courseid}}&section={{section}}" class="nav-button next">
                <span>Next Section</span>
                <i class="fas fa-chevron-right"></i>
            </a>
            {{/next_section}}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add animations to activity items
    const activityItems = document.querySelectorAll('.activity-item');
    activityItems.forEach((item, index) => {
        setTimeout(() => {
            item.classList.add('animate');
        }, index * 100);
    });
    
    // Add click handlers for activity items
    activityItems.forEach(item => {
        item.addEventListener('click', function(e) {
            if (!e.target.closest('.btn-activity')) {
                const activityId = this.dataset.activity;
                const activityUrl = this.querySelector('.btn-activity').href;
                window.location.href = activityUrl;
            }
        });
    });
});
</script>