{{!
    Section Viewer Template
    
    @template theme_remui_kids/section_viewer
    
    Section viewer with activities in linked list format
}}

<!-- Include section viewer CSS -->
<link rel="stylesheet" href="{{wwwroot}}/theme/remui_kids/style/section_viewer.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<div class="section-viewer-container">
    <!-- Page Header -->
    <div class="section-header">
        <div class="header-content">
            <div class="course-info">
                <div class="course-image">
                    <img src="{{course_image_url}}" alt="{{course.fullname}}" onerror="this.src='{{wwwroot}}/theme/remui_kids/pix/default_course.svg'">
                </div>
                <div class="course-details">
                    <h1>{{course.fullname}}</h1>
                    <h2 class="section-title">{{section_name}}</h2>
                    <div class="section-meta">
                        <span class="meta-item">
                            <i class="fas fa-tasks"></i>
                            {{total_activities}} Activities
                        </span>
                        <span class="meta-item">
                            <i class="fas fa-check-circle"></i>
                            {{completed_count}} Completed
                        </span>
                        <span class="meta-item">
                            <i class="fas fa-chart-line"></i>
                            {{progress_percentage}}% Progress
                        </span>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <a href="{{back_url}}" class="btn-back">
                    <i class="fas fa-arrow-left"></i>
                    Back to Learning Path
                </a>
            </div>
        </div>
    </div>

    <!-- Section Summary -->
    {{#section_summary}}
    <div class="section-summary">
        <div class="summary-content">{{{section_summary}}}</div>
    </div>
    {{/section_summary}}

    <!-- Progress Bar -->
    <div class="progress-section">
        <div class="progress-header">
            <h3>Section Progress</h3>
            <span class="progress-text">{{completed_count}}/{{total_activities}} activities completed</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" style="width: {{progress_percentage}}%"></div>
        </div>
    </div>

    <!-- Activities List -->
    <div class="activities-container">
        <h3 class="activities-title">
            <i class="fas fa-list"></i>
            Section Activities
        </h3>
        
        {{#activities}}
        <div class="activity-list">
            {{#activities}}
            <div class="activity-item {{#completed}}completed{{/completed}}" data-activity="{{id}}">
                <!-- Connection line to next activity -->
                {{^last}}
                <div class="connection-line"></div>
                {{/last}}
                
                <!-- Activity node -->
                <div class="activity-node">
                    <div class="node-circle {{#completed}}completed{{/completed}}">
                        {{#completed}}
                        <i class="fas fa-check"></i>
                        {{/completed}}
                        {{^completed}}
                        <i class="fas fa-{{icon}}"></i>
                        {{/completed}}
                    </div>
                </div>
                
                <!-- Activity content -->
                <div class="activity-content">
                    <div class="activity-header">
                        <h4 class="activity-name">{{name}}</h4>
                        <div class="activity-type">
                            <span class="type-badge">{{modname}}</span>
                        </div>
                    </div>
                    
                    <div class="activity-status">
                        {{#completed}}
                        <span class="status-completed">
                            <i class="fas fa-check-circle"></i>
                            Completed
                        </span>
                        {{/completed}}
                        {{^completed}}
                        <span class="status-pending">
                            <i class="fas fa-clock"></i>
                            Pending
                        </span>
                        {{/completed}}
                    </div>
                    
                    <div class="activity-actions">
                        <a href="{{url}}" class="btn-activity {{#completed}}btn-review{{/completed}}">
                            {{#completed}}
                            <i class="fas fa-eye"></i>
                            Review Activity
                            {{/completed}}
                            {{^completed}}
                            <i class="fas fa-play"></i>
                            Start Activity
                            {{/completed}}
                        </a>
                    </div>
                </div>
            </div>
            {{/activities}}
        </div>
        {{/activities}}
    </div>

    <!-- Navigation -->
    <div class="section-navigation">
        {{#prev_section}}
        <a href="{{wwwroot}}/theme/remui_kids/section_viewer.php?courseid={{courseid}}&section={{section}}" class="nav-button prev">
            <i class="fas fa-chevron-left"></i>
            <span>Previous Section</span>
        </a>
        {{/prev_section}}
        
        {{#next_section}}
        <a href="{{wwwroot}}/theme/remui_kids/section_viewer.php?courseid={{courseid}}&section={{section}}" class="nav-button next">
            <span>Next Section</span>
            <i class="fas fa-chevron-right"></i>
        </a>
        {{/next_section}}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add animations to activity items
    const activityItems = document.querySelectorAll('.activity-item');
    activityItems.forEach((item, index) => {
        setTimeout(() => {
            item.classList.add('animate');
        }, index * 100);
    });
    
    // Add click handlers for activity items
    activityItems.forEach(item => {
        item.addEventListener('click', function(e) {
            if (!e.target.closest('.btn-activity')) {
                const activityId = this.dataset.activity;
                const activityUrl = this.querySelector('.btn-activity').href;
                window.location.href = activityUrl;
            }
        });
    });
});
</script>