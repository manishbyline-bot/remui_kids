{{!
    Learning Path Template
    
    @template theme_remui_kids/learning_path
    
    Course learning path with sections and activities
}}

<!-- Include learning path CSS -->
<link rel="stylesheet" href="{{wwwroot}}/theme/remui_kids/style/learning_path.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<div class="learning-path-container">
    <!-- Page Header -->
    <div class="learning-path-header">
        <div class="header-content">
            <div class="course-info">
                <div class="course-image">
                    <img src="{{course_image_url}}" alt="{{course.fullname}}" onerror="this.src='{{wwwroot}}/theme/remui_kids/pix/default_course.svg'">
                </div>
                <div class="course-details">
                    <h1>{{course.fullname}}</h1>
                    <p class="course-summary">{{course.summary}}</p>
                    <div class="course-meta">
                        <span class="meta-item">
                            <i class="fas fa-book"></i>
                            {{#has_sections}}{{sections.length}} Sections{{/has_sections}}
                            {{^has_sections}}No sections available{{/has_sections}}
                        </span>
                        <span class="meta-item">
                            <i class="fas fa-clock"></i>
                            Self-paced
                        </span>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <a href="{{back_url}}" class="btn-back">
                    <i class="fas fa-arrow-left"></i>
                    Back to Courses
                </a>
            </div>
        </div>
    </div>

    <!-- Learning Path Content -->
    <div class="learning-path-content">
        {{#has_sections}}
        <div class="learning-path-list">
            {{#sections}}
            <div class="path-item {{#is_locked}}locked{{/is_locked}} {{#is_completed}}completed{{/is_completed}}" data-section="{{section}}">
                <!-- Connection line to next item -->
                {{^last}}
                <div class="connection-line"></div>
                {{/last}}
                
                <!-- Section node -->
                <div class="section-node">
                    <div class="node-circle {{#is_locked}}locked{{/is_locked}} {{#is_completed}}completed{{/is_completed}}">
                        {{#is_locked}}
                        <i class="fas fa-lock"></i>
                        {{/is_locked}}
                        {{#is_completed}}
                        <i class="fas fa-check"></i>
                        {{/is_completed}}
                        {{^is_locked}}{{^is_completed}}<span class="section-number">{{section}}</span>{{/is_completed}}{{/is_locked}}
                    </div>
                </div>
                
                <!-- Section content -->
                <div class="section-content">
                    <div class="section-header">
                        <h3 class="section-title">{{name}}</h3>
                        <div class="section-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{completion_percentage}}%"></div>
                            </div>
                            <span class="progress-text">{{completed_count}}/{{activity_count}} activities</span>
                        </div>
                    </div>
                    
                    {{#summary}}
                    <div class="section-summary">
                        <div class="summary-content">{{{summary}}}</div>
                    </div>
                    {{/summary}}
                    
                    {{#activities}}
                    <div class="activities-list">
                        <div class="activity-item {{#completed}}completed{{/completed}}">
                            <div class="activity-icon">
                                <i class="fas fa-{{icon}}"></i>
                            </div>
                            <div class="activity-info">
                                <h4>{{name}}</h4>
                                <p class="activity-type">{{modname}}</p>
                            </div>
                            <div class="activity-status">
                                {{#completed}}
                                <span class="status-completed">
                                    <i class="fas fa-check"></i>
                                    Completed
                                </span>
                                {{/completed}}
                                {{^completed}}
                                <span class="status-pending">
                                    <i class="fas fa-clock"></i>
                                    Pending
                                </span>
                                {{/completed}}
                            </div>
                        </div>
                    </div>
                    {{/activities}}
                    
                    <div class="section-footer">
                        {{#is_locked}}
                        <div class="locked-message">
                            <i class="fas fa-lock"></i>
                            Complete previous section to unlock
                        </div>
                        {{/is_locked}}
                        {{^is_locked}}
                        {{#is_completed}}
                        <div class="completed-message">
                            <i class="fas fa-check-circle"></i>
                            Section Completed!
                        </div>
                        {{/is_completed}}
                        {{^is_completed}}
                        <a href="{{wwwroot}}/theme/remui_kids/section_viewer.php?courseid={{courseid}}&section={{section}}" class="btn-primary">
                            <i class="fas fa-play"></i>
                            Start Section
                        </a>
                        {{/is_completed}}
                        {{/is_locked}}
                    </div>
                </div>
            </div>
            {{/sections}}
        </div>
        {{/has_sections}}
        
        {{^has_sections}}
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-book-open"></i>
            </div>
            <h3>No Learning Path Available</h3>
            <p>This course doesn't have any sections or activities configured yet.</p>
            <a href="{{back_url}}" class="btn-primary">
                <i class="fas fa-arrow-left"></i>
                Back to Courses
            </a>
        </div>
        {{/has_sections}}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add animations to path items
    const pathItems = document.querySelectorAll('.path-item');
    pathItems.forEach((item, index) => {
        setTimeout(() => {
            item.classList.add('animate');
        }, index * 150);
    });
    
    // Add click handlers for path items
    pathItems.forEach(item => {
        item.addEventListener('click', function(e) {
            if (!e.target.closest('.btn-primary') && !e.target.closest('.btn-locked')) {
                const section = this.dataset.section;
                const courseId = new URLSearchParams(window.location.search).get('courseid');
                window.location.href = `{{wwwroot}}/theme/remui_kids/section_viewer.php?courseid=${courseId}&section=${section}`;
            }
        });
    });
});
</script>